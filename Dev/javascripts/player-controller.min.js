function getUrlParameter(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),n=t.exec(location.search);return null===n?null:decodeURIComponent(n[1].replace(/\+/g," "))}function processParams(){const e=getUrlParameter("video"),t=getUrlParameter("VRBtn"),n=getUrlParameter("autoPlay"),a=getUrlParameter("loop"),i=getUrlParameter("debug"),s=getUrlParameter("console"),o=getUrlParameter("iosPerm");if("false"===o&&$("a-scene").attr("device-orientation-permission-ui","enabled: false"),"true"!==i){$(".debugger").hide();const e=console.error;console.error=function(t){"THREE.WebGLState:"===t.toString()&&init(),e(t)}}else window.Hls.DefaultConfig.debug=!0,"false"===s?$(".debugger").hide():setupDebugger();if(window.mediaController=new MediaController("video_player_id"),mediaController.build360Player(autoplay="false"!==n,vrBtn="false"!==t,iosPerm="false"!==o,video_src=e),null!==e){if(playlist.streams[0]=e,"false"!==n?setTimeout(()=>{mediaController.currentTime()>0||mediaController.play()},3e3):mediaController.autoPlay=!1,"true"===a&&(mediaController.video.loop=!0),"false"===t){var r=document.getElementsByTagName("head").item(0),d=document.createElement("style");d.type="text/css",d.appendChild(document.createTextNode(".a-enter-vr-button {display: none;}")),r.appendChild(d)}}else mediaController.setLoader(!0,!0);mediaController.subscribeToBufferingEvents(),"true"===i&&subscribeToAllEvents(),window.mediaFilter=new MediaColorFilter("player")}const MediaEvent={ABORTED:1,CAN_PLAY:2,CAN_PLAY_THROUGH:3,DURATION_CHANGE:4,ENDED:5,ERROR:6,LOADED_DATA:7,LOADED_META_DATA:8,LOAD_START:9,PAUSE:10,PLAY:11,PLAYING:12,PROGRESS:13,RATE_CHANGE:14,SEEKED:15,SEEKING:16,STALLED:17,SUSPEND:18,TIME_UPDATE:19,VOLUME_CHANGE:20,WAITING:21,EXTERNAL:22};Object.freeze(MediaEvent);class MediaMessage{constructor(e,t,n){this.readyState=e,this.eventType=t,this.message=n}getMessage(){const e={readyState:this.readyState,event:this.eventType,message:this.message};return JSON.stringify(e)}}class MediaMessageChannel{constructor(e,t=!1){this.controller=e,this.useConsoleForMessage=t,this.errorDisplayed=!1,this._timeout=null}videoHackListener(){const e=document.querySelector("video");setTimeout(function(){const e=document.querySelector("#scene_id");e.renderer.setSize(e.canvas.width,e.canvas.height)},500),e.removeEventListener("canplay",this.videoHackListener)}onVideoPlaybackFailure(){this.controller.setLoader(!0,!0)}onVideoPlaybackSuccess(){this.controller.setLoader(!1)}onVideoPlaybackWaiting(e=!1){this.controller.setLoader(!0,!1,!0),e&&this.retryPlay()}retryPlay(){self=this,this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout(()=>{self.controller.video.load(),self.controller.play()},3e3)}onVideoEvents(){const e=this.controller.video.readyState;4===e?this.onVideoPlaybackSuccess():this.onVideoPlaybackWaiting()}subscribe(e,t=this){const n=this.controller.video;e==MediaEvent.ABORTED&&(n.onabort=function(){t.onVideoPlaybackSuccess(),t.sendMessage(MediaEvent.ABORTED)}),e==MediaEvent.CAN_PLAY&&(n.oncanplay=function(){t.onVideoPlaybackSuccess(),t.sendMessage(MediaEvent.CAN_PLAY)}),e==MediaEvent.CAN_PLAY_THROUGH&&(n.oncanplaythrough=function(){t.onVideoPlaybackSuccess(),t.sendMessage(MediaEvent.CAN_PLAY_THROUGH)}),e==MediaEvent.DURATION_CHANGE&&(n.ondurationchange=function(){t.sendMessage(MediaEvent.DURATION_CHANGE)}),e==MediaEvent.ENDED&&(n.onended=function(){t.sendMessage(MediaEvent.ENDED)}),e==MediaEvent.ERROR&&(n.onerror=function(){t.onVideoPlaybackFailure(),t.sendMessage(MediaEvent.ERROR)}),e==MediaEvent.LOADED_DATA&&(n.onloadeddata=function(){t.onVideoPlaybackSuccess(),t.sendMessage(MediaEvent.LOADED_DATA)}),e==MediaEvent.LOADED_META_DATA&&(n.onloadedmetadata=function(){t.sendMessage(MediaEvent.LOADED_META_DATA)}),e==MediaEvent.LOAD_START&&(n.onloadstart=function(){t.onVideoPlaybackWaiting(),t.sendMessage(MediaEvent.LOAD_START)}),e==MediaEvent.PAUSE&&(n.onpause=function(){t.sendMessage(MediaEvent.PAUSE)}),e==MediaEvent.PLAY&&(n.onplay=function(){t.sendMessage(MediaEvent.PLAY)}),e==MediaEvent.PLAYING&&(n.onplaying=function(){t.onVideoPlaybackSuccess(),t.sendMessage(MediaEvent.PLAYING)}),e==MediaEvent.PROGRESS&&(n.onprogress=function(){t.onVideoEvents(),t.sendMessage(MediaEvent.PROGRESS)}),e==MediaEvent.RATE_CHANGE&&(n.onratechange=function(){t.sendMessage(MediaEvent.RATE_CHANGE)}),e==MediaEvent.SEEKED&&(n.onseeked=function(){t.sendMessage(MediaEvent.SEEKED)}),e==MediaEvent.SEEKING&&(n.onseeking=function(){t.sendMessage(MediaEvent.SEEKING)}),e==MediaEvent.STALLED&&(n.onstalled=function(){t.onVideoPlaybackWaiting(!0),t.sendMessage(MediaEvent.STALLED)}),e==MediaEvent.SUSPEND&&(n.onsuspend=function(){t.sendMessage(MediaEvent.SUSPEND)}),e==MediaEvent.TIME_UPDATE&&(n.ontimeupdate=function(){t.onVideoEvents(),t.sendMessage(MediaEvent.TIME_UPDATE)}),e==MediaEvent.VOLUME_CHANGE&&(n.onvolumechange=function(){t.sendMessage(MediaEvent.VOLUME_CHANGE)}),e==MediaEvent.WAITING&&(n.onwaiting=function(){t.onVideoPlaybackWaiting(),t.sendMessage(MediaEvent.WAITING)})}unsubscribe(e){const t=this.controller.video;e==MediaEvent.ABORTED&&(t.onabort=this.onVideoPlaybackSuccess),e==MediaEvent.CAN_PLAY&&(t.oncanplay=this.onVideoPlaybackSuccess),e==MediaEvent.CAN_PLAY_THROUGH&&(t.oncanplaythrough=this.onVideoPlaybackSuccess),e==MediaEvent.DURATION_CHANGE&&(t.ondurationchange=null),e==MediaEvent.ENDED&&(t.onended=null),e==MediaEvent.ERROR&&(t.onerror=this.onVideoPlaybackFailure),e==MediaEvent.LOADED_DATA&&(t.onloadeddata=this.onVideoPlaybackSuccess),e==MediaEvent.LOADED_META_DATA&&(t.onloadedmetadata=null),e==MediaEvent.LOAD_START&&(t.onloadstart=null),e==MediaEvent.PAUSE&&(t.onpause=null),e==MediaEvent.PLAY&&(t.onplay=null),e==MediaEvent.PLAYING&&(t.onplaying=null),e==MediaEvent.PROGRESS&&(t.onprogress=this.onVideoEvents()),e==MediaEvent.RATE_CHANGE&&(t.onratechange=null),e==MediaEvent.SEEKED&&(t.onseeked=null),e==MediaEvent.SEEKING&&(t.onseeking=null),e==MediaEvent.STALLED&&(t.onstalled=this.onVideoPlaybackFailure),e==MediaEvent.SUSPEND&&(t.onsuspend=null),e==MediaEvent.TIME_UPDATE&&(t.ontimeupdate=this.onVideoEvents()),e==MediaEvent.VOLUME_CHANGE&&(t.onvolumechange=null),e==MediaEvent.WAITING&&(t.onwaiting=this.onVideoPlaybackWaiting)}sendMessage(e,t=""){const n=new MediaMessage(this.controller.video.readyState,e,t);try{return this._postMessage(n.getMessage()),!0}catch(e){this.useConsoleForMessage?(console.warn("postMessage is not defined. Setting : MediaMessageChannel.postMessage = console.log"),MediaMessageChannel.postMessage=console.log):this.errorDisplayed||(console.warn("postMessage is not defined. Set : MediaMessageChannel.postMessage = someFunction"),this.errorDisplayed=!0)}return!1}_postMessage(e){MediaMessageChannel.postMessage(e)}}class MediaController{constructor(e){this.videoID=e,this.video=null,this.autoPlay=!0,this.channel=new MediaMessageChannel(this),this.__playerBuilt=!1,this.src=null,this.cam=null,this._flat=!1}resetCamera(){this.cam.components["touch-look-controls"].yawObject.rotation.set(0,0,0),this.cam.components["touch-look-controls"].pitchObject.rotation.set(0,0,0)}toggleTouch(e=!0){this.cam.components["touch-look-controls"].data.enabled=e}togglePlayer(e=!0,t=16/9,n=0){var a=document.querySelector("#videosphere");e?(this.resetCamera(),a.removeAttribute("geometry","radius"),a.setAttribute("geometry","primitive","plane"),a.setAttribute("geometry","width",t),a.object3D.rotation.y=Math.PI,a.object3D.rotation.z=Math.PI/180*n,a.object3D.position.y=1.6,a.object3D.position.z=-1,setTimeout(()=>this.toggleTouch(!1),100)):(a.removeAttribute("geometry","width"),a.setAttribute("geometry","primitive","sphere"),a.object3D.rotation.y=0,a.object3D.rotation.z=0,a.object3D.position.y=1.6,a.object3D.position.z=0,setTimeout(()=>this.toggleTouch(!0),100)),"flat"!=a.getAttribute("material").shader&&this.resetShader()}resetShader(){var e=document.querySelector("#videosphere");e.setAttribute("material","shader","flat")}build360Player(e=!0,t=!0,n=!0,a=null,i=!0){const s=`\n        <a-scene \n            loading-screen="dotsColor: white; backgroundColor: black" \n            vr-mode-ui="enabled: ${t}" \n            ar-mode-ui="enabled: false" \n            id="scene_id"\n            class="player"\n            device-orientation-permission-ui="enabled: ${n}"\n        >\n            <a-assets>\n                <video \n                src="${a}"\n                id="${this.videoID}" autoplay="${e}" muted="${i}" playsinline webkit-playsinline preload="auto" crossorigin="anonymous"></video>\n            </a-assets>\n            <a-entity id="camera" camera="active: true" position="0 1.6 0" touch-look-controls></a-entity>\n            <a-videosphere id="videosphere" src="#${this.videoID}"></a-videosphere>\n\n        </a-scene>`;if(this.__playerBuilt)console.log("Player already built!!");else{this.__playerBuilt=!0,this.src=a,$("body").prepend(s),this.video=document.getElementById(this.videoID),this.cam=document.querySelector("#camera");var o=document.querySelector("#videosphere");o.addEventListener("materialvideoloadeddata",this.resetShader)}}get isFlat(){return this._flat}viewInFlat(e=!0,t=null){if(this.__playerBuilt&&!this._flat){this._flat=!0;const n=t||(e?window.innerHeight/window.innerWidth:window.innerWidth/window.innerHeight);e?this.togglePlayer(!0,n,90):this.togglePlayer(!0,n)}return""}viewInMono(){return this.__playerBuilt&&this._flat&&(this._flat=!1,this.togglePlayer(!1)),""}setLoader(e,t=!1,n=!1){const a=$("#spinner");!0===e?a.show():a.hide(),t?a.addClass("error"):a.removeClass("error"),n?a.addClass("buffering"):a.removeClass("buffering")}seek(e){return this.currentTime(this.currentTime()+e),""}currentTime(e){return e<this.duration&&e>0?(this.video.currentTime=e,""):this.video.currentTime}play(e){return this.subscribeToBufferingEvents(),mediaController.setLoader(!0),this.video.play().then(function(){console.log("playing...")}).catch(function(e){mediaController.setLoader(!0),console.log("PlayBack Failed: "+JSON.stringify({code:e.code,message:e.message,name:e.name})),"Failed to load because no supported source was found."!==e.message&&"The element has no supported sources."!=e.message||hlsLoad()}),e&&(this.video.currentTime=e),""}pause(){return this.video.pause(),""}playbackRate(e){return e<5&&e>-1?(this.video.playbackRate=e,""):this.video.playbackRate}forceReplay(){return this.pause(),this.currentTime(0),init(!0),""}load(e,t=!1){return this.pause(),this.currentTime(0),playlist.streams[0]=e,init(!0),t?this.play():this.pause(),""}enterVRMode(){const e=$("a-scene")[0];return e.enterVR(),""}exitVRMode(){const e=$("a-scene")[0];return e.exitVR(),""}subscribeToAllEvents(){const e=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21];for(var t of e)this.channel.subscribe(t);return""}unSubscribeFromAllEvents(){const e=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21];for(var t of e)this.channel.unsubscribe(t);return""}subscribe(...e){for(var t of e)this.channel.subscribe(t);return""}unsubscribe(...e){for(var t of e)this.channel.unsubscribe(t);return""}mute(){return this.video.muted=!0,""}unmute(){return this.video.muted=!1,""}subscribeToBufferingEvents(){this.subscribe(MediaEvent.ABORTED,MediaEvent.CAN_PLAY,MediaEvent.CAN_PLAY_THROUGH,MediaEvent.ERROR,MediaEvent.LOADED_DATA,MediaEvent.LOAD_START,MediaEvent.PLAYING,MediaEvent.STALLED,MediaEvent.WAITING,MediaEvent.PROGRESS)}get state(){return this.video.readyState}get paused(){return this.video.paused}get duration(){return this.video.duration}get volume(){return 100*this.video.volume}get isMuted(){return this.video.muted}}document.title="",document.addEventListener("DOMContentLoaded",processParams);